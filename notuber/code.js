function makeMap(){navigator.geolocation?navigator.geolocation.getCurrentPosition(showPosition):x.innerHTML="Geolocation is not supported by this browser."}function showPosition(n){const t=n.coords.latitude,o=n.coords.longitude,e={lat:t,lng:o},a=new google.maps.Map(document.getElementById("map"),{zoom:2,center:e});myMark=new google.maps.Marker({position:e,map:a});var s=new XMLHttpRequest,i="username=vot48s6K&lat="+t+"&lng="+o;s.open("POST","https://secret-reef-32430.herokuapp.com/rides",!0),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.onreadystatechange=function(){if(4==s.readyState&&200==s.status){content=addCars(s.responseText,a,t,o),contentWindow="<h1>Closest Car to my Position</h1><p>ID: "+content[1]+"</p><p>Username: "+content[2]+"</p><p>Distance: "+content[0]+" miles</p>";const n=new google.maps.InfoWindow({content:contentWindow});myMark.addListener("click",()=>{n.open({anchor:myMark,map:a,shouldFocus:!1})})}},list=s.send(i)}function addCars(n,t,o,e){var a;for(obj=JSON.parse(n),a=0;a<n.length;a++)try{addInfoWindow(obj,a,t,o,e)}catch(n){console.log("Unhandled Promise Rejection: TypeError")}return findDistance(n,o,e,t)}function findDistance(n,t,o,e){var a;for(value=-1,id="",username="",smallLat=0,smallLong=0,a=0;a<n.length;a++)try{const n=6371e3,e=t*Math.PI/180,s=obj[a].lat*Math.PI/180,i=(obj[a].lat-t)*Math.PI/180,r=(obj[a].lng-o)*Math.PI/180,l=Math.sin(i/2)*Math.sin(i/2)+Math.cos(e)*Math.cos(s)*Math.sin(r/2)*Math.sin(r/2),c=n*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)));(-1==value||c<value)&&(value=c,id=obj[a].id,username=obj[a].username,smallLat=obj[a].lat,smallLong=obj[a].lng)}catch(n){console.log("Unhandled Promise Rejection: TypeError")}const s=[{lat:t,lng:o},{lat:smallLat,lng:smallLong}];return new google.maps.Polyline({path:s,geodesic:!0,strokeColor:"#8A2BE2",strokeOpacity:1,strokeWeight:2}).setMap(e),value/=1609.344,[value,id,username]}function addInfoWindow(n,t,o,e,a){position={lat:n[t].lat,lng:n[t].lng},newMark=new google.maps.Marker({position:position,map:o}),newMark.setIcon("car.png");const s=e*Math.PI/180,i=n[t].lat*Math.PI/180,r=(n[t].lat-e)*Math.PI/180,l=(n[t].lng-a)*Math.PI/180,c=Math.sin(r/2)*Math.sin(r/2)+Math.cos(s)*Math.cos(i)*Math.sin(l/2)*Math.sin(l/2),d=6371e3*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)))/1609.344;contentWindow="<h1>This car's info</h1><p>ID: "+n[t].id+"</p><p>Username: "+n[t].username+"</p><p>Distance from me: "+d+" miles</p>";var h=new google.maps.InfoWindow({content:contentWindow});newMark.infowindow=h,newMark.addListener("click",function(){return this.infowindow.open(o,this)})}